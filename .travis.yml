sudo: required
services:
  - docker
matrix:
  # Donâ€™t wait for jobs that are allowed to fail
  fast_finish: true
cache:
  - directories:
    - ~/docker/
env:
  matrix:
    - EMACS_VERSION=24.3
    - EMACS_VERSION=24.5
    - EMACS_VERSION=25.1
before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/1.8.1/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - mkdir -p ~/docker
  - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; else docker pull larsbrinkhoff/emacsen:latest && docker save larsbrinkhoff/emacsen:latest > ~/docker/image.tar; fi
script:
  - if [[ -n $EMACS_VERSION ]]; then docker-compose run app emacs --version; fi
  # Compile and test
  - if [[ -n $EMACS_VERSION ]]; then docker-compose run app make travis; fi
notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/efdc5fd9433efa7c6b80
    on_success: change
    on_failure: always
    on_start: never
